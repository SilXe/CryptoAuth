{"ast":null,"code":"import { standardErrors } from '../core/error/errors.js';\nimport { NAME, VERSION } from '../sdk-info.js';\nimport { Snackbar } from '../sign/walletlink/relay/ui/components/Snackbar/Snackbar.js';\nimport { RETRY_SVG_PATH } from '../sign/walletlink/relay/ui/WalletLinkRelayUI.js';\nimport { getCrossOriginOpenerPolicy } from './checkCrossOriginOpenerPolicy.js';\nconst POPUP_WIDTH = 420;\nconst POPUP_HEIGHT = 540;\nconst RETRY_BUTTON = {\n  isRed: false,\n  info: 'Retry',\n  svgWidth: '10',\n  svgHeight: '11',\n  path: RETRY_SVG_PATH,\n  defaultFillRule: 'evenodd',\n  defaultClipRule: 'evenodd'\n};\nconst POPUP_BLOCKED_MESSAGE = 'Popup was blocked. Try again.';\nlet snackbar = null;\nexport function openPopup(url) {\n  const left = (window.innerWidth - POPUP_WIDTH) / 2 + window.screenX;\n  const top = (window.innerHeight - POPUP_HEIGHT) / 2 + window.screenY;\n  appendAppInfoQueryParams(url);\n  function tryOpenPopup() {\n    const popupId = `wallet_${crypto.randomUUID()}`;\n    const popup = window.open(url, popupId, `width=${POPUP_WIDTH}, height=${POPUP_HEIGHT}, left=${left}, top=${top}`);\n    popup === null || popup === void 0 ? void 0 : popup.focus();\n    if (!popup) {\n      return null;\n    }\n    return popup;\n  }\n  let popup = tryOpenPopup();\n  // If the popup was blocked, show a snackbar with a retry button\n  if (!popup) {\n    const sb = initSnackbar();\n    return new Promise((resolve, reject) => {\n      sb.presentItem({\n        autoExpand: true,\n        message: POPUP_BLOCKED_MESSAGE,\n        menuItems: [Object.assign(Object.assign({}, RETRY_BUTTON), {\n          onClick: () => {\n            popup = tryOpenPopup();\n            if (popup) {\n              resolve(popup);\n            } else {\n              reject(standardErrors.rpc.internal('Popup window was blocked'));\n            }\n            sb.clear();\n          }\n        })]\n      });\n    });\n  }\n  return Promise.resolve(popup);\n}\nexport function closePopup(popup) {\n  if (popup && !popup.closed) {\n    popup.close();\n  }\n}\nfunction appendAppInfoQueryParams(url) {\n  const params = {\n    sdkName: NAME,\n    sdkVersion: VERSION,\n    origin: window.location.origin,\n    coop: getCrossOriginOpenerPolicy()\n  };\n  for (const [key, value] of Object.entries(params)) {\n    url.searchParams.append(key, value.toString());\n  }\n}\nfunction initSnackbar() {\n  if (!snackbar) {\n    const root = document.createElement('div');\n    root.className = '-cbwsdk-css-reset';\n    document.body.appendChild(root);\n    snackbar = new Snackbar();\n    snackbar.attach(root);\n  }\n  return snackbar;\n}","map":{"version":3,"names":["standardErrors","NAME","VERSION","Snackbar","RETRY_SVG_PATH","getCrossOriginOpenerPolicy","POPUP_WIDTH","POPUP_HEIGHT","RETRY_BUTTON","isRed","info","svgWidth","svgHeight","path","defaultFillRule","defaultClipRule","POPUP_BLOCKED_MESSAGE","snackbar","openPopup","url","left","window","innerWidth","screenX","top","innerHeight","screenY","appendAppInfoQueryParams","tryOpenPopup","popupId","crypto","randomUUID","popup","open","focus","sb","initSnackbar","Promise","resolve","reject","presentItem","autoExpand","message","menuItems","onClick","rpc","internal","clear","closePopup","closed","close","params","sdkName","sdkVersion","origin","location","coop","key","value","Object","entries","searchParams","append","toString","root","document","createElement","className","body","appendChild","attach"],"sources":["../../src/util/web.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}